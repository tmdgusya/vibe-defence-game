# ISSUE: Wave Completion Bonus Gold Not Awarded

## Metadata

- **Reporter**: Senior Developer (Claude)
- **Date Reported**: 2026-01-13
- **Last Updated**: 2026-01-13
- **Status**: Open
- **Priority**: Medium
- **Type**: Bug
- **Assignee**: [Junior Developer]
- **Labels**: bug, economy-system, wave-system
- **Related Issue ID**: Related to ISSUE-BUG-002

## 1. Issue Summary

### One-Sentence Summary

When a wave is completed, the wave completion bonus gold is not awarded to the player.

### Impact Assessment

- **Users Affected**: 100% of players
- **Severity**: Minor - Reduces gold income, but game still playable
- **Business Impact**: Economy weaker than designed; harder progression

## 2. Issue Classification

### Type Details

**Bug**: `waveCompleted` event includes bonus value but it's never added to player's gold.

### Wave Bonus Configuration (from EnemySystem)

| Wave | Bonus |
| ---- | ----- |
| 1    | 25g   |
| 2    | 30g   |
| 3    | 40g   |
| 4    | 45g   |
| 5    | 75g   |
| 6    | 50g   |
| 7    | 60g   |
| 8    | 70g   |
| 9    | 80g   |
| 10   | 100g  |

## 3. Environment & Context

### Affected Components

- [x] **System**: Wave management, economy system
- [ ] **Game Engine**: Phaser (event fires correctly)
- [x] **UI Framework**: React (event handler incomplete)

### Reproduction Steps

1. Start game, place a tower
2. Press SPACE to start Wave 1
3. Complete wave (kill all enemies or let them pass)
4. Check gold - no bonus added

### Expected Behavior

- Wave completes → `waveCompleted` event fires with bonus
- Handler adds bonus gold to player's total
- UI shows updated gold amount

### Actual Behavior

- Wave completes → `waveCompleted` event fires with bonus
- Handler only logs the event, doesn't add gold
- Gold remains unchanged

## 4. Technical Details

### Code Context

```typescript
// src/systems/EnemySystem.ts:343-350 - Bonus is sent
private completeWave(): void {
  this.isWaveActive = false;
  const config = this.getWaveConfig(this.currentWave);

  emitEvent('waveCompleted', {
    wave: this.currentWave,
    bonus: config.waveBonus,  // Bonus is included!
  });
}
```

```typescript
// src/components/PhaserGame.tsx:121-124 - Bonus is ignored!
const handleWaveCompleted = (data: GameEvents['waveCompleted']): void => {
  console.log(`Wave ${data.wave} completed, bonus: ${data.bonus}`);
  // Wave number will be updated when next wave starts
  // BONUS IS NEVER ADDED TO GOLD!
};
```

### Files to Modify

1. `src/components/PhaserGame.tsx` - Fix handleWaveCompleted

## 5. Solution Strategy

### Recommended Solution

Add gold reward logic to `handleWaveCompleted` function.

### Implementation Approach

```typescript
// src/components/PhaserGame.tsx
const handleWaveCompleted = (data: GameEvents['waveCompleted']): void => {
  console.log(`Wave ${data.wave} completed, bonus: ${data.bonus}`);

  const state = useGameStore.getState();
  const newGold = state.gold + data.bonus;

  // Add bonus gold
  state.setGold(newGold);

  // Emit goldChanged for UI sync
  emitEvent('goldChanged', { gold: newGold, change: data.bonus });
};
```

## 6. Implementation Plan

### Development Tasks

- [ ] **Task 1**: Modify `handleWaveCompleted` to add bonus gold
- [ ] **Task 2**: Call `state.setGold()` with bonus added
- [ ] **Task 3**: Emit `goldChanged` event
- [ ] **Task 4**: Add visual feedback for bonus (optional: toast notification)
- [ ] **Task 5**: Test with multiple waves

### Testing Requirements

- [ ] **Manual Testing**:
  - Complete Wave 1 → +25g bonus
  - Complete Wave 5 → +75g bonus
  - Complete Wave 10 → +100g bonus
- [ ] **Visual Testing**: Gold counter updates on wave complete

### Dependencies

- Should be done alongside ISSUE-BUG-002 (enemy kill gold)

## 7. Verification & Acceptance

### Definition of Done

- [ ] Wave completion awards bonus gold
- [ ] Bonus amount matches wave configuration
- [ ] Gold UI updates immediately on wave complete
- [ ] Bonus visible in console log (existing)

### Test Scenarios

1. Complete Wave 1 → Gold increases by 25
2. Complete Wave 5 → Gold increases by 75 (boss wave bonus)
3. Complete Wave 10 → Gold increases by 100

## 8. Related Documents

- [PhaserGame.tsx](../../src/components/PhaserGame.tsx)
- [EnemySystem.ts](../../src/systems/EnemySystem.ts)
- ISSUE-BUG-002 (related gold issue)

## 9. Revision History

| Version | Date       | Author     | Changes        |
| ------- | ---------- | ---------- | -------------- |
| v1.0    | 2026-01-13 | Senior Dev | Issue reported |
